
-- Script para crear la tabla SERVICIOS_REPARACION en Oracle Database
-- Ejecutar este script en tu base de datos antes de usar el sistema

CREATE TABLE SERVICIOS_REPARACION (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOMBRE_CLIENTE VARCHAR2(100) NOT NULL,
    TELEFONO VARCHAR2(20) NOT NULL,
    EMAIL VARCHAR2(100) NOT NULL,
    TIPO_DISPOSITIVO VARCHAR2(50) NOT NULL,
    MARCA VARCHAR2(50) NOT NULL,
    MODELO VARCHAR2(100) NOT NULL,
    DESCRIPCION_PROBLEMA CLOB NOT NULL,
    FECHA_AGENDADA TIMESTAMP NOT NULL,
    FECHA_CREACION TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ESTADO VARCHAR2(30) DEFAULT 'AGENDADO' NOT NULL,
    TECNICO_ASIGNADO VARCHAR2(100),
    COSTO_ESTIMADO NUMBER(10,2),
    COSTO_FINAL NUMBER(10,2),
    OBSERVACIONES VARCHAR2(500),
    FECHA_INICIO_REPARACION TIMESTAMP,
    FECHA_FIN_REPARACION TIMESTAMP,
    PRIORIDAD VARCHAR2(20) DEFAULT 'NORMAL',
    GARANTIA_DIAS NUMBER DEFAULT 30,
    ACTIVO NUMBER(1) DEFAULT 1,
    
    -- Constraints
    CONSTRAINT chk_servicios_estado CHECK (ESTADO IN ('AGENDADO', 'EN_REVISION', 'EN_REPARACION', 
        'ESPERANDO_REPUESTOS', 'COMPLETADO', 'ENTREGADO', 'CANCELADO', 'EN_GARANTIA')),
    CONSTRAINT chk_servicios_prioridad CHECK (PRIORIDAD IN ('BAJA', 'NORMAL', 'ALTA', 'URGENTE')),
    CONSTRAINT chk_servicios_activo CHECK (ACTIVO IN (0, 1)),
    CONSTRAINT chk_servicios_email CHECK (EMAIL LIKE '%@%')
);

-- Crear índices para mejorar el rendimiento
CREATE INDEX idx_servicios_email ON SERVICIOS_REPARACION(EMAIL);
CREATE INDEX idx_servicios_estado ON SERVICIOS_REPARACION(ESTADO);
CREATE INDEX idx_servicios_tipo ON SERVICIOS_REPARACION(TIPO_DISPOSITIVO);
CREATE INDEX idx_servicios_fecha_agendada ON SERVICIOS_REPARACION(FECHA_AGENDADA);
CREATE INDEX idx_servicios_tecnico ON SERVICIOS_REPARACION(TECNICO_ASIGNADO);
CREATE INDEX idx_servicios_activo ON SERVICIOS_REPARACION(ACTIVO);

-- Insertar algunos servicios de ejemplo
INSERT INTO SERVICIOS_REPARACION (
    NOMBRE_CLIENTE, TELEFONO, EMAIL, TIPO_DISPOSITIVO, MARCA, MODELO, 
    DESCRIPCION_PROBLEMA, FECHA_AGENDADA, ESTADO, PRIORIDAD
) VALUES (
    'Juan Pérez', '+56987654321', 'juan.perez@email.com', 'Smartphone', 
    'Apple', 'iPhone 13', 'Pantalla rota tras caída', 
    CURRENT_TIMESTAMP + INTERVAL '1' DAY, 'AGENDADO', 'NORMAL'
);

INSERT INTO SERVICIOS_REPARACION (
    NOMBRE_CLIENTE, TELEFONO, EMAIL, TIPO_DISPOSITIVO, MARCA, MODELO, 
    DESCRIPCION_PROBLEMA, FECHA_AGENDADA, ESTADO, PRIORIDAD, TECNICO_ASIGNADO
) VALUES (
    'María González', '+56912345678', 'maria.gonzalez@email.com', 'Laptop', 
    'HP', 'Pavilion 15', 'No enciende, problema con cargador', 
    CURRENT_TIMESTAMP + INTERVAL '2' DAY, 'EN_REVISION', 'ALTA', 'Carlos Mendoza'
);

INSERT INTO SERVICIOS_REPARACION (
    NOMBRE_CLIENTE, TELEFONO, EMAIL, TIPO_DISPOSITIVO, MARCA, MODELO, 
    DESCRIPCION_PROBLEMA, FECHA_AGENDADA, ESTADO, PRIORIDAD, COSTO_ESTIMADO
) VALUES (
    'Pedro Silva', '+56998765432', 'pedro.silva@email.com', 'Tablet', 
    'Samsung', 'Galaxy Tab S7', 'Pantalla táctil no responde en algunas zonas', 
    CURRENT_TIMESTAMP + INTERVAL '3' DAY, 'AGENDADO', 'NORMAL', 85000
);

-- Comentarios sobre la tabla
COMMENT ON TABLE SERVICIOS_REPARACION IS 'Tabla de servicios de reparación de ReparaFacilSPA';
COMMENT ON COLUMN SERVICIOS_REPARACION.NOMBRE_CLIENTE IS 'Nombre completo del cliente';
COMMENT ON COLUMN SERVICIOS_REPARACION.EMAIL IS 'Correo electrónico del cliente';
COMMENT ON COLUMN SERVICIOS_REPARACION.ESTADO IS 'Estado actual del servicio de reparación';
COMMENT ON COLUMN SERVICIOS_REPARACION.PRIORIDAD IS 'Prioridad del servicio: BAJA, NORMAL, ALTA, URGENTE';
COMMENT ON COLUMN SERVICIOS_REPARACION.ACTIVO IS 'Estado del registro: 1=Activo, 0=Eliminado';

COMMIT;